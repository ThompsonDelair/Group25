<html>
    <head>
        <meta charset="utf-8"/>
        <title>fishin'</title>
        <link rel="stylesheet" href="fishing.css" />
    </head>
    <body>
        <canvas id="canvas" width="640" height="640"></canvas>
    </body>
    <script>
        
        var bg = new Image;
        bg.src = "images/bg640.png";
        
        var erikfish = new Image;
        erikfish.src = "images/erikfish.png";
        
        let frame1 = new Image;
        frame1.src = "images/frame1.png"
        
        let frame2 = new Image;
        frame2.src = "images/frame2.png"
        
        let frame3 = new Image;
        frame3.src = "images/frame3.png"
        
        var currentFrame = frame1;
        
        let fishcanvas = document.getElementById("canvas");        
        let context = canvas.getContext('2d');
        
        
        //  O N  C L I C K
        
        var playingAnimation = false;
        var mouseX = 0;
        var mouseY = 0;
        fishcanvas.addEventListener('mousedown',function(){
            var x = event.pageX - fishcanvas.offsetLeft;
            var y = event.pageY;
            mouseX = x;
            mouseY = y;
            //console.log(x);
            //console.log(y);
            console.log(fishes.length+" fish remain!");
            fishes.forEach(function(item, index){
                var fish = item;
                if(mouseX > item.x && mouseX < (item.x + item.width)){
                    if(mouseY > item.y && mouseY < (item.y + item.height)){
                        //console.log(fishes.length+" fish remain!");
                        fishes.splice(index,1);
                        if(playingAnimation == false){
                            playAnimation();
                        }
                    }
                }
            });
            
        },false);
        
        function playAnimation(){
            playingAnimation = true;
            currentFrame = frame2;
            console.log("playing animation ...");
            setTimeout(playAnimation2,150);            
        }
        
        function playAnimation2(){
            currentFrame = frame3;
            console.log("playing animation2 ...");
            setTimeout(playAnimation3,250);
        }
        
        function playAnimation3(){
            currentFrame = frame1;
            console.log("playing animation3 ...");
            playingAnimation = false;
        }
        
        var x = 0;
        var y = 0;
        
        
        var fishcounter = 0;
        var spawnCooldown = 30;
        var spawnTimeStamp = 0;
        var fishes = new Array();
        function Fish (){
            this.x = 0;
            this.y = 0;
            this.width = 50;
            this.height = 40;
            this.direction = 1;
        }        
        
        var ticker = setInterval(tick,30);
        var totalTicks = 0;
        function tick(){
            
            //console.log("tick!");
            
            if(fishcounter < 20 && spawnTimeStamp < totalTicks){
                var newFish = new Fish()
                newFish.y = Math.random() * ((canvas.height/2) - 60) + 30 + (canvas.height/2);
                newFish.x = Math.random() * (canvas.width - 60) + 30;
                fishes.push(newFish); 
                spawnTimeStamp += spawnCooldown;
                fishcounter++;
            }
            
            
            //  R E N D E R  
            
            // background
            context.fillStyle="#04aae1";
            context.fillRect(0,0,canvas.width,canvas.height);
            
            // backgroud image
            context.drawImage(bg,0,0);
            
            // turt
            context.drawImage(currentFrame,0,0);
            
            // render fishies
            fishes.forEach(function(item){
                var fish = item;
                context.drawImage(erikfish,item.x,item.y);
                if(fish.x < 1 || fish.x > fishcanvas.width){
                    
                }
            });
            
            // last click position
            context.fillStyle="#FF0000";
            context.fillRect(mouseX - 2.5,mouseY - 2.5,5,5);
            
            totalTicks++;
        }
        
    </script>
</html>